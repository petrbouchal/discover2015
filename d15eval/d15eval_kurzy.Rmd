---
title: 'Discover 2015: kurzy souhrnně'
output:
  html_document:
    fig_height: 8
    fig_width: 8
    fig_caption: no
    theme: null
    toc: yes
    css: custom.css
  pdf_document: default
---

```{r Prep, echo=F, include=F}

library(knitr)
library(Cairo)
# set up graphing:
opts_chunk$set(echo=FALSE, dev='CairoPNG', warning=FALSE)
# make relative references work - change this to project directory
opts_knit$set(root.dir='~/github/experiments/d15eval/')

CairoFonts(
  regular="Gill Sans MT:style=Regular",
  bold="Gill Sans MT:style=Bold",
  italic="Gill Sans MT:style=Italic",
  bolditalic="Gill Sans MT:style=Bold Italic,BoldItalic",
  symbol="Symbol"
)

setwd("~/github/experiments/d15eval/")
source("./d15eval_setup.R")
setwd("~/github/experiments/d15eval/")
source("./d15eval_kurzy_setup.R")

kurzy3 <- kurzy_long %>% 
  filter(variable %in% dnyvtydnu,
         !is.na(kurz)) %>% 
  mutate(value=as.numeric(value),
         variable = droplevels(variable),
         variable = factor(variable, levels=dnyvtydnu))

loadcustomthemes(fontfamily = "Gill Sans MT")
theme_discover_multi <- theme(panel.grid.minor=element_line(color="grey96", size=.25),
                        panel.grid.major=element_line(color="white", size=.5),
                        strip.text = element_text(size=9, color="grey20", hjust=0.1),
                        panel.background = element_rect(fill="grey96"),
                        axis.text.x = element_text(size=10),
                        strip.background=element_rect(fill="grey96"),
                        plot.title=element_text(size=10, lineheight=0.5, hjust=0),
                        legend.key.width=unit(.3,"cm"))

theme_discover <- theme(panel.grid.minor=element_line(color="grey96", size=.2),
                        panel.grid.major=element_line(color="grey96", size=.3),
                        strip.text = element_text(size=12, color="grey20"),
                        panel.background = element_rect(fill="white"),
                        axis.text.x = element_text(size=11),
                        strip.background=element_rect(fill="white"),
                        legend.key.width=unit(.3,"cm"))

```

Zpětná vazba Discover 2015 júl: srovnání kurzů
==================

----------

Ke každému kurzu je na Google Drive k dispozici samostatný soubor s detailními výsledky včetně slovní zpětné vazby.

# Hodnocení kurzů

```{r PoDnech, echo=F, dev="CairoPNG",fig.cap="",dpi=200, fig.retina=2}
kurzy4 <- kurzy3 %>% 
  group_by(variable, kurz, kurzslot) %>% 
  summarise(value = mean(value, na.rm = T))

kurzy5 <- kurzy3 %>% 
  group_by(variable, kurz) %>% 
  summarise(value = mean(value, na.rm = T))

kurzy5$kurzslot <- "oba"
kurzyplot <- rbind(kurzy4, kurzy5)

kurzyplot <- kurzyplot %>% 
  group_by(kurz, variable) %>% 
  mutate(pocetslotu = n()-1)

ggplot(kurzyplot, aes(x=variable, y=value, group=kurzslot, colour=kurzslot)) +
  geom_line(size=1) +
  geom_point(size=3, pch=19) +
  facet_wrap(~ kurz, ncol=4) + 
  scale_y_continuous(limits=c(1,3)) +
  scale_colour_manual(values=c("lightgoldenrod1","aquamarine3","black")) +
  geom_text(aes(label=formatC(value, digits=2, format="f"),
                y=value+.2),
            size=2.5, colour="grey40",fontface="bold",
            data=kurzyplot[kurzyplot$kurzslot=="oba",]) +
  theme_discover_multi
```

##  Hodnocení lektora

```{r Lektori, echo=F, dev="CairoPNG",fig.cap="", dpi=200, fig.retina=2, fig.height=12}
lektor <- kurzy_long %>%
  filter(grepl("kurzobsah_",.$variable), !is.na(kurz)) %>% 
  mutate(variable = droplevels(variable)) %>% 
  group_by(kurz, variable, value) %>% 
  summarise(pocet = n())

lektor_wide <- dcast(lektor, "... ~ value")

lektor$variable <- plyr::revalue(lektor$variable,
                                 c("kurzobsah_lekodbornik"="Byl lektor dostatečný odborník na tento kurz?",
                                   "kurzobsah_lekpoutave"="Učil lektor poutavě?",
                                   "kurzobsah_lekpripraveny"="Byl lektor dobře připravený na tento kurz?",
                                   "kurzobsah_lekpristupny"="Byl lektor přístupný i mimo setkání kurzu?",
                                   "kurzobsah_lekvysvet"="Vysvětloval lektor srozumitelně?",
                                   "kurzobsah_lekzapoj"="Vytvořil ti lektor prostor zapojit se do dění v kurzu?",
                                   "kurzobsah_prinos"="Byl kurz pro tebe celkově přínosný?",
                                   "kurzobsah_problemzapojit"="Měl/a jsi problém zapojit se do dění v kurzu?"
                                 ))
negativnihodnoty <- c("Určitě ne", "Spíše ne")
lektor2 <- lektor %>%  
  mutate(share=pocet/sum(pocet),
         share = ifelse(value %in% negativnihodnoty, -share, share),
         share = ifelse(value=="Nevím", -share/2, share)) %>% 
  filter(!is.na(variable))

addthis <- lektor2[lektor2$value=="Nevím",]
addthis$share <- -addthis$share
lektor2 <- rbind(lektor2, addthis)

lektor2 <- lektor2[!is.na(lektor2$variable),]
lektor2$variable <- droplevels(lektor2$variable)

lektor2$value <- ordered(lektor2$value)

l_positive <- lektor2[lektor2$share>0,]
l_negative <- lektor2[lektor2$share<0,]

l_negative$value <- ordered(l_negative$value, levels = levels(l_negative$value))

l_positive <- l_positive[!is.na(l_positive$variable),]
l_negative <- l_negative[!is.na(l_negative$variable),]

l_positive <- arrange(l_positive, value)
l_negative <- arrange(l_negative, desc(value))

ggplot() +
  aes(fill=value, x=variable, y=share, group=kurz, order=value) +
  geom_bar(stat="identity", position="stack", color="grey96",
           data=l_positive) +
  geom_bar(stat="identity", position="stack", color="grey96",
           data=l_negative) +
  facet_wrap(~kurz, ncol = 4) + 
  coord_flip() +
  # scale_fill_brewer(palette = "RdBu") +
  scale_fill_manual(values=c("Určitě ne"="firebrick3",
                             "Spíše ne"="firebrick1",
                             "Nevím"="grey95",
                             "Spíše ano"="steelblue1",
                             "Určitě ano"="steelblue3"),
                    breaks=c("Určitě ne","Spíše ne","Nevím","Spíše ano",
                             "Určitě ano")) +
  scale_y_continuous(labels=percent) +
  scale_x_discrete(labels=function(x) {str_wrap(x, width = 30)}) +
  guides(fill = guide_legend(override.aes = list(colour = NULL))) +
  theme_discover_multi + theme(panel.grid.major.y=element_blank(),
                         panel.grid.major.x=element_line(color="white"),
                         axis.text.y=element_text(size=9))
```


```{r Removal, echo=F}
rm("addthis", "hod", "kurzhodavg", "kurzhodavg_c", "kurzy2", "kurzy3",
   "kurzy4", "kurzy5", "lektor2")
```

## Didaktika

### Jak lektor učí

**Co nejlépe vystihuje, jak lektor učí?**

```{r JakUci, echo=F, dev="CairoPNG",fig.cap="", dpi=200, fig.retina=2}

dida <- kurzy_long %>% 
  filter(grepl("jakuci",variable), !is.na(value), !is.na(kurz)) %>% 
  group_by(kurz, variable, value) %>%
  summarise(pocet=n()) %>% 
  group_by(kurz, variable) %>% 
  mutate(share=pocet/sum(pocet))

dida$value <- as.factor(dida$value)
# levels(dida$value)
dida$value <- factor(dida$value, levels(dida$value)[c(2,1,4,3)])
dida <- arrange(dida, desc(value))

ggplot(dida, aes(value, share, fill=variable, order=value, group=kurz)) +
  geom_area(stat="identity", fill="lightgoldenrod1") +
  geom_point(stat="identity", colour="lightgoldenrod1", size=2) +
  coord_flip() +
  scale_x_discrete(drop=F, labels = function(x) str_wrap(x, width = 20)) +
  facet_wrap(~kurz, ncol=4) +
  scale_y_continuous(labels=percent) +
  theme_discover_multi + theme(panel.grid.major.y=element_blank(),
                                panel.grid.minor.x=element_blank(),
                                panel.grid.major.x=element_line(),
                                axis.text.y=element_text(size=9),legend.position="none")

```

### Přednášky *versus* interaktivita

**Přednášel lektor sám, nebo učil interaktivně?**

```{r Interaktivita, echo=F, dev="CairoPNG",fig.cap="", dpi=200, fig.retina=2}

dida <- kurzy_long %>% 
  filter(grepl("kurzsamvsInteraktiv",variable), !is.na(value), !is.na(kurz)) %>% 
  group_by(kurz, variable, value) %>%
  summarise(pocet=n()) %>% 
  group_by(kurz, variable) %>% 
  mutate(share=pocet/sum(pocet))

dida$value <- as.factor(dida$value)
# levels(dida$value)
dida$value <- factor(dida$value, levels(dida$value)[c(3,2,5,4,1)])
dida <- arrange(dida, desc(value))

ggplot(dida,
                aes(value, share, fill=variable, order=value, group=kurz)) +
  geom_area(stat="identity", fill="aquamarine3") +
  geom_point(stat="identity", colour="aquamarine3", size=2) +
  coord_flip() +
  scale_x_discrete(drop=F, labels = function(x) str_wrap(x, width = 20)) +
  scale_y_continuous(labels=percent) +
  facet_wrap(~kurz, ncol=4) +
  theme_discover_multi + theme(panel.grid.major.y=element_blank(),
                                panel.grid.minor.x=element_blank(),
                                panel.grid.major.x=element_line(),
                                axis.text.y=element_text(size=10),legend.position="none")
```

### Jak by měli lektoři změnit svůj styl?

**Měl by lektor učit jinak?**

```{r Jakzmenit, echo=F, dev="CairoPNG",fig.cap="",dpi=200, fig.retina=2, fig.height=10}

dida <- kurzy_long %>% 
  filter(grepl("kurzucitjinak",variable), !is.na(value), !is.na(kurz)) %>% 
  group_by(kurz, variable, value) %>%
  summarise(pocet=n()) %>% 
  group_by(kurz, variable) %>% 
  mutate(share=pocet/sum(pocet))

dida$value <- as.factor(dida$value)
# levels(dida$value)
dida$value <- factor(dida$value, levels(dida$value)[c(6,4,3,5,2,1)])
dida <- arrange(dida, desc(value))

ggplot(dida,
                aes(value, share, fill=variable, order=value, group=kurz)) +
  geom_area(stat="identity", fill="firebrick1") +
  geom_point(stat="identity", colour="firebrick1", size=2) +
  coord_flip() +
  scale_x_discrete(drop=F, labels = function(x) str_wrap(x, width = 20)) +
  scale_y_continuous(labels=percent) +
  facet_wrap(~kurz, ncol=4) +
  theme_discover_multi + theme(panel.grid.major.y=element_blank(),
                                panel.grid.minor.x=element_blank(),
                                panel.grid.major.x=element_line(),
                                axis.text.y=element_text(size=10),legend.position="none")
```

## Náročnost

#### **Jak hodnotíš náročnost...**

```{r Narocnost, echo=F, dev="CairoPNG",fig.cap="",dpi=200, fig.retina=2}

negativnihodnoty <- c("Velmi těžké","Spíše těžké")
vhodne <- c("Vhodně náročné")

narocnost <- kurzy_long %>% 
  filter(grepl("narocnost",variable)) %>% 
  group_by(kurz, variable, value) %>%
  summarise(pocet=n()) %>% 
  group_by(kurz, variable) %>% 
  mutate(share=pocet/sum(pocet)) %>% 
  mutate(share = ifelse(value %in% negativnihodnoty,-share, share),
         share = ifelse(value %in% vhodne,-share/2, share)) %>%
  filter(!is.na(value)) %>% 
  filter(value!="Mého kurzu se netýká") %>% 
  filter(!is.na(variable))

narocnost$variable <- plyr::revalue(narocnost$variable,
                                 c("kurznarocnost_narochod"="setkání kurzu",
                                   "kurznarocnost_narocpracetu"="práce na letní škole",
                                   "kurznarocnost_narocmater"="materiálů před Discover"
                                 ))

addthis <- narocnost[narocnost$value=="Vhodně náročné",]
addthis$share <- -addthis$share
narocnost <- rbind(narocnost, addthis)

narocnost$value <- ordered(narocnost$value)
narocnost$value <- ordered(narocnost$value, levels=levels(narocnost$value)[c(6,3,2,5,4,1)])
l_positive <- narocnost[narocnost$share>0,]
l_negative <- narocnost[narocnost$share<0,]

l_positive <- l_positive[!is.na(l_positive$variable),]
l_negative <- l_negative[!is.na(l_negative$variable),]

l_positive <- arrange(l_positive, desc(value))
l_negative <- arrange(l_negative, value)

ggplot() +
  aes(fill=value, x=variable, y=share, group=kurz, order=value) +
  geom_bar(stat="identity", position="stack", color="grey96",
           data=l_positive) +
  geom_bar(stat="identity", position="stack", color="grey96",
           data=l_negative) +
  facet_wrap(~kurz, ncol = 4) + 
  coord_flip() +
  # scale_fill_brewer(palette = "RdBu") +
  scale_fill_manual(values=c("Velmi těžké"="firebrick3",
                             "Spíše těžké"="firebrick1",
                             "Vhodně náročné"="white",
                             "Spíše lehké"="steelblue1",
                             "Velmi lehké"="steelblue3",
                             "Nevím"="grey80"),
                    breaks=c("Velmi těžké","Spíše těžké","Vhodně náročné",
                             "Spíše lehké","Velmi lehké","Nevím")) +
  scale_y_continuous(labels=percent) +
  scale_x_discrete(labels=function(x) {str_wrap(x, width=15)}) +
  guides(fill = guide_legend(override.aes = list(colour = NULL))) +
  theme_discover_multi + theme(panel.grid.major.y=element_blank(),
                         panel.grid.major.x=element_line(color="white"),
                         axis.text.y=element_text(size=9))
```

### Jak se studentům nejlépe učí?

#### **Jak se ti na kurzu nejlépe pracovalo?**

```{r JakNejlepePracuje, Jdev="CairoPNG", fig.cap="",dpi=200, fig.retina=2, fig.height=7,fig.cap=""}

dida <- kurzy_long %>% 
  filter(grepl("kurzjaknejlepepraco",variable), !is.na(value), !is.na(kurz)) %>% 
  group_by(kurz, variable, value) %>%
  summarise(pocet=n()) %>% 
  group_by(kurz, variable) %>% 
  mutate(share=pocet/sum(pocet))

dida$value <- as.factor(dida$value)
# levels(dida$value)
dida <- arrange(dida, desc(value))

ggplot(dida,
                aes(value, share, fill=variable, order=value, group=kurz)) +
  geom_bar(stat="identity", fill="hotpink1") +
  coord_flip() +
  scale_x_discrete(drop=F, labels = function(x) str_wrap(x, width = 10)) +
  scale_y_continuous(labels=percent) +
  facet_wrap(~kurz, ncol=4) +
  theme_discover_multi + theme(panel.grid.major.y=element_blank(),
                                panel.grid.minor.x=element_blank(),
                                panel.grid.major.x=element_line(),
                                axis.text.y=element_text(size=10),legend.position="none")
```

#### **Jak se ti na kurzu nejlépe učí?**

```{r JakNejlepeUci, dev="CairoPNG", dpi=200, fig.cap="", fig.height=7, fig.retina=2}
dida <- kurzy_long %>% 
  filter(grepl("kurzjaknejuci",variable), !is.na(value), !is.na(kurz)) %>% 
  group_by(kurz, variable, value) %>%
  summarise(pocet=n()) %>% 
  group_by(kurz, variable) %>% 
  mutate(share=pocet/sum(pocet))

dida$value <- as.factor(dida$value)
# levels(dida$value)
dida$value <- factor(dida$value, levels(dida$value)[c(4, 3, 2, 1, 5)])
dida <- arrange(dida, desc(value))

ggplot(dida,
                aes(value, share, fill=variable, order=value, group=kurz)) +
  geom_bar(stat="identity", fill="turquoise1") +
  coord_flip() +
  scale_x_discrete(drop=F, labels = function(x) str_wrap(x, width = 10)) +
  scale_y_continuous(labels=percent) +
  facet_wrap(~kurz, ncol=4) +
  theme_discover_multi + theme(panel.grid.major.y=element_blank(),
                                panel.grid.minor.x=element_blank(),
                                panel.grid.major.x=element_line(),
                                axis.text.y=element_text(size=10),legend.position="none")

```

# Bonus: jak udělat skvělý kurz

```{r SkvelyKurz, dev="CairoPNG", dpi=200, fig.cap="", fig.height=7, fig.retina=2, results="hide"}

setwd("~/github/experiments/d15eval/")
velikost <- read.csv("velikostkurzu.csv")
velikost <- melt(velikost, id.vars="kurz")
velikost <- plyr::rename(velikost,c("variable"="kurzslot", "value"="velikost")) 

hod <- filter(kurzy_long, variable %in% dnyvtydnu)
hod$value <- as.numeric(hod$value)

model <- lm(value ~ variable + rocnik + pohlavi + kurzslot + kurz, data = hod)
# summary(model)

library(sjPlot)
sjp.setTheme(geom.label.size = 2, axis.tickslen = 0, panel.backcol = NULL)
modelplot <- sjp.lm(model, sort.est = F)

```
